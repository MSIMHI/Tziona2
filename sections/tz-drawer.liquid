{{ 'tz-main-cart.css' | asset_url | stylesheet_tag }}

<div class="cart-overlay" id="cartOverlay"></div>
<div class="cart-drawer" id="cartDrawer">
  <div class="cart-promo">{{ section.settings.promo_text }}</div>
  <div class="cart-header">
    <script>
      window.cartStrings = {
        empty: `{{ 'sections.cart.empty' | t }}`
      };
    </script>
    <div class="cart-title-row">
      <span class="cart-title-main">{{ 'templates.cart.cart' | t }}</span>
      <span class="cart-title-count">{{ 'sections.cart.tz.items_count' | t: count: cart.item_count }}</span>
    </div>
    <button class="close-cart-btn" id="closeCartBtn">&times;</button>
  </div>

  <div class="shipping-bar">
    <div class="shipping-text">{{ 'sections.cart.tz.shipping_free_calculated_at_checkout' | t }}</div>
    <div class="shipping-progress">
      <!-- Example logic: fill 100% if price > threshold -->
      <div class="shipping-progress-fill" style="width: 100%;"></div>
    </div>
  </div>

  <div class="cart-body">
    <div class="cart-items-list">
      {% if cart.item_count > 0 %}
        {% for item in cart.items %}
          <div class="cart-item">
            {% if item.image %}
              {{ item.image | image_url: width: 200 | image_tag }}
            {% else %}
              {{ 'product-1' | placeholder_svg_tag }}
            {% endif %}

            <div class="item-details">
              <div class="item-title">
                <a href="{{ item.url }}">{{ item.product.title }}</a>
              </div>
              <div class="item-variant">{{ item.variant.title }}</div>
              <div class="qty-selector">
                <button
                  type="button"
                  class="qty-btn qty-btn-minus"
                  data-line="{{ forloop.index }}"
                  data-quantity="{{ item.quantity | minus: 1 }}"
                  aria-label="Decrease quantity"
                >
                  &minus;
                </button>
                <div class="qty-val">{{ item.quantity }}</div>
                <button
                  type="button"
                  class="qty-btn qty-btn-plus"
                  data-line="{{ forloop.index }}"
                  data-quantity="{{ item.quantity | plus: 1 }}"
                  aria-label="Increase quantity"
                >
                  &plus;
                </button>
              </div>
            </div>
            <div class="item-price-col">
              <div class="item-price">{{ item.final_line_price | money }}</div>
              <button
                type="button"
                class="item-remove"
                data-line="{{ forloop.index }}"
                aria-label="Remove item"
              >
                {{ 'sections.cart.remove' | t }}
              </button>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div style="padding: 30px; text-align:center;">{{ 'sections.cart.empty' | t }}</div>
      {% endif %}
    </div>

    <div class="tz-cart-note">
      <button type="button" class="tz-cart-note-button" aria-expanded="false">
        <span>{{ 'sections.cart.tz.add_order_note' | t }}</span>
        <span class="material-icons-outlined">add</span>
      </button>
      <cart-note class="tz-cart-note-element" style="display: none;">
        <textarea
          class="tz-cart-note-textarea"
          name="note"
          placeholder="{{ 'sections.cart.tz.add_order_note' | t }}"
          rows="4"
        >{{ cart.note }}</textarea>
      </cart-note>
    </div>
  </div>

  <div class="cart-footer">
    {% if cart.item_count > 0 %}
      <a href="{{ routes.cart_url }}" class="tz-cart-drawer-view-cart">
        {{ 'general.cart.view' | t: count: cart.item_count }}
      </a>
    {% endif %}
    <form action="{{ routes.cart_url }}" method="post" id="cart-drawer-form">
      <button type="submit" name="checkout" class="checkout-btn">
        <span>{{ 'sections.cart.tz.checkout_amount' | t }}</span>
        <span>&bull;</span>
        <span>{{ cart.total_price | money }}</span>
      </button>
    </form>
    <span class="shipping-taxes-text">{{ 'sections.cart.tz.taxes_and_shipping_at_checkout' | t }}</span>
  </div>
</div>

<!-- MOBILE MENU OVERLAY -->
<div class="mobile-menu-overlay"></div>

<!-- MOBILE MENU DRAWER -->
<div class="mobile-menu-drawer" id="mobile-menu-drawer">
  <div class="mobile-menu-content">
    <div class="mobile-menu-header">
      <div class="mobile-menu-logo">
        <a href="{{ routes.root_url }}">
          {% if settings.logo != blank %}
            {{ settings.logo | image_url: width: 300 | image_tag: height: 20 }}
          {% else %}
            {{ shop.name }}
          {% endif %}
        </a>
      </div>
      <button class="mobile-menu-close" aria-label="{{ 'accessibility.close' | t }}">
        <span class="material-icons-outlined">close</span>
      </button>
    </div>
    <nav class="mobile-menu-nav">
      {% for link in linklists[section.settings.mobile_menu].links %}
        <a href="{{ link.url }}" class="mobile-menu-link">{{ link.title }}</a>
      {% endfor %}
      {% if section.settings.show_sale %}
        <a href="{{ section.settings.sale_link }}" class="mobile-menu-link mobile-menu-sale">
          {{ 'general.header.sale_text' | t | default: section.settings.sale_text }}
          <span class="sale-badge">{{ 'general.header.sale_badge' | t | default: section.settings.sale_badge }}</span>
        </a>
      {% endif %}
    </nav>
  </div>
</div>

{% schema %}
{
  "name": "TZ Cart & Menu Drawer",
  "settings": [
    {
      "type": "header",
      "content": "Cart Settings"
    },
    {
      "type": "text",
      "id": "promo_text",
      "label": "Promo Bar Text",
      "default": "לקוחות חדשים חוסכים 10% עם קוד WELCOME10"
    },
    {
      "type": "header",
      "content": "Mobile Menu Settings"
    },
    {
      "type": "link_list",
      "id": "mobile_menu",
      "label": "Mobile Menu",
      "default": "main-menu"
    },
    {
      "type": "checkbox",
      "id": "show_sale",
      "label": "Show Sale Link",
      "default": true
    },
    {
      "type": "text",
      "id": "sale_text",
      "label": "Sale Text",
      "default": "במבצע עכשיו"
    },
    {
      "type": "text",
      "id": "sale_badge",
      "label": "Sale Badge",
      "default": "30% OFF"
    },
    {
      "type": "url",
      "id": "sale_link",
      "label": "Sale Link"
    }
  ]
}
{% endschema %}

<script src="{{ 'tz-main-cart.js' | asset_url }}" defer="defer"></script>
