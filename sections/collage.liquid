{{ 'tz-collage.css' | asset_url | stylesheet_tag }}
<script src="{{ 'tz-collage.js' | asset_url }}" defer="defer"></script>

{%- style -%}
  #shopify-section-{{ section.id }} {
    --tz-pt: {{ section.settings.padding_top }}px;
    --tz-pb: {{ section.settings.padding_bottom }}px;
  }
{%- endstyle -%}

<div class="tz-collage-section color-{{ section.settings.color_scheme }}">
  <div class="tz-collage-container">
    {%- if section.settings.heading != blank -%}
      <h2 class="tz-collage-title {{ section.settings.heading_size }}">
        {{ section.settings.heading }}
      </h2>
    {%- endif -%}

    <div class="tz-collage-grid tz-collage-grid--{{ section.settings.desktop_layout }} tz-collage-grid--{{ section.settings.mobile_layout }}">
      {%- for block in section.blocks -%}
        <div class="tz-collage-item tz-collage-item--{{ block.type }}" {{ block.shopify_attributes }}>
          {%- case block.type -%}
            {%- when 'image' -%}
              <div class="tz-collage-card">
                {%- if block.settings.image != blank -%}
                  {{ block.settings.image | image_url: width: 2000 | image_tag: loading: 'lazy' }}
                {%- else -%}
                  {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                {%- endif -%}
              </div>

            {%- when 'product' -%}
              <div class="tz-collage-card">
                {%- if block.settings.product != blank -%}
                  <a href="{{ block.settings.product.url }}" class="full-unstyled-link">
                    {%- if block.settings.product.featured_media != blank -%}
                      {{ block.settings.product.featured_media | image_url: width: 1000 | image_tag: loading: 'lazy' }}
                    {%- else -%}
                      {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                    {%- endif -%}
                    <div class="tz-collage-card-info">
                       <h3 class="h4">{{ block.settings.product.title }}</h3>
                       <p>{{ block.settings.product.price | money }}</p>
                    </div>
                  </a>
                {%- else -%}
                   {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                {%- endif -%}
              </div>

            {%- when 'collection' -%}
              <div class="tz-collage-card">
                {%- if block.settings.collection != blank -%}
                  <a href="{{ block.settings.collection.url }}" class="full-unstyled-link">
                    {%- if block.settings.collection.featured_image != blank -%}
                      {{ block.settings.collection.featured_image | image_url: width: 1000 | image_tag: loading: 'lazy' }}
                    {%- else -%}
                      {{ 'collection-1' | placeholder_svg_tag: 'placeholder-svg' }}
                    {%- endif -%}
                    <div class="tz-collage-card-info">
                       <h3 class="h4">{{ block.settings.collection.title }}</h3>
                    </div>
                  </a>
                {%- else -%}
                  {{ 'collection-1' | placeholder_svg_tag: 'placeholder-svg' }}
                {%- endif -%}
              </div>

            {%- when 'video' -%}
              <div class="tz-collage-card">
                {%- if block.settings.cover_image != blank -%}
                  {{ block.settings.cover_image | image_url: width: 2000 | image_tag: loading: 'lazy' }}
                {%- else -%}
                  {{ 'hero-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
                {%- endif -%}
                
                {%- liquid
                  assign video_id = block.settings.video_url.id
                  if block.settings.video_url.type == 'youtube'
                    assign video_url = 'https://www.youtube.com/embed/' | append: video_id | append: '?autoplay=1'
                  else
                    assign video_url = 'https://player.vimeo.com/video/' | append: video_id | append: '?autoplay=1'
                  endif
                -%}

                <button type="button" class="tz-collage-video-btn" data-video-url="{{ video_url }}" aria-label="{{ 'sections.video.load_video' | t: description: block.settings.description | escape }}">
                  <span class="material-icons-outlined">play_arrow</span>
                </button>
              </div>
          {%- endcase -%}
        </div>
      {%- endfor -%}
    </div>
  </div>
</div>

<!-- Video Modal -->
<div id="tz-video-modal" class="tz-video-modal">
  <div class="tz-video-modal-content">
    <button id="tz-video-modal-close" class="tz-video-modal-close">
      <span class="material-icons-outlined">close</span>
      {{ 'accessibility.close' | t }}
    </button>
    <iframe src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
  </div>
</div>

{% schema %}
{
  "name": "TZ Collage",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "Collage",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        { "value": "h2", "label": "Small" },
        { "value": "h1", "label": "Medium" },
        { "value": "h0", "label": "Large" }
      ],
      "default": "h1",
      "label": "Heading Size"
    },
    {
      "type": "select",
      "id": "desktop_layout",
      "options": [
        { "value": "left", "label": "Large item left" },
        { "value": "right", "label": "Large item right" }
      ],
      "default": "left",
      "label": "Desktop Layout"
    },
    {
      "type": "select",
      "id": "mobile_layout",
      "options": [
        { "value": "collage", "label": "Collage" },
        { "value": "column", "label": "Column" }
      ],
      "default": "column",
      "label": "Mobile Layout"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    },
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "checkbox",
          "id": "second_image",
          "default": false,
          "label": "Show second image on hover"
        }
      ]
    },
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    },
    {
      "type": "video",
      "name": "Video",
      "settings": [
        {
          "type": "image_picker",
          "id": "cover_image",
          "label": "Cover Image"
        },
        {
          "type": "video_url",
          "id": "video_url",
          "accept": ["youtube", "vimeo"],
          "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc",
          "label": "Video URL"
        },
        {
          "type": "text",
          "id": "description",
          "label": "Video description (for accessibility)"
        }
      ]
    }
  ],
  "max_blocks": 3,
  "presets": [
    {
      "name": "TZ Collage",
      "blocks": [
        { "type": "image" },
        { "type": "product" },
        { "type": "collection" }
      ]
    }
  ]
}
{% endschema %}
