{{ 'tz-main-collection-product-grid.css' | asset_url | stylesheet_tag }}
{{ 'tz-featured-collection.css' | asset_url | stylesheet_tag }}
<script src="{{ 'tz-featured-collection.js' | asset_url }}" defer="defer"></script>

{%- liquid
  assign products_limit = section.settings.products_to_show | default: 8
  assign show_slider = section.settings.enable_slider | default: false
  assign has_products = false
  if section.settings.collection and section.settings.collection.products.size > 0
    assign has_products = true
  endif
-%}

<section class="tz-featured-collection-section" data-section-id="{{ section.id }}">
  <div class="tz-featured-collection-container">
    {%- comment -%} Section Header {%- endcomment -%}
    {%- if section.settings.title != blank -%}
      <header class="tz-collection-header">
        <h2 class="tz-collection-title {{ section.settings.heading_size }}">
          {{ section.settings.title }}
        </h2>
        {%- if section.settings.description != blank -%}
          <p class="tz-collection-description">
            {{ section.settings.description }}
          </p>
        {%- endif -%}
      </header>
    {%- endif -%}

    {%- comment -%} Products Grid {%- endcomment -%}
    {%- if has_products -%}
      {%- if show_slider -%}
        <div class="tz-collection-slider-container">
          <div class="tz-collection-slider" data-slider>
            {%- for product in section.settings.collection.products limit: products_limit -%}
              {% assign lazy_load = false %}
              {%- if forloop.index > 2 -%}
                {%- assign lazy_load = true -%}
              {%- endif -%}
              <div class="tz-collection-slide">
                {% render 'tz-collection-product-card',
                  product: product,
                  lazy_load: lazy_load
                %}
              </div>
            {%- endfor -%}
          </div>

          <nav class="tz-collection-slider-controls" aria-label="Product navigation">
            <button class="tz-collection-slider-btn tz-collection-slider-prev" data-slider-prev aria-label="Previous products">
              <span class="material-icons-outlined">chevron_right</span>
            </button>
            <div class="tz-collection-slider-counter">
              <span class="tz-collection-counter-current" data-current-slide>1</span>
              <span aria-hidden="true"> / </span>
              <span class="tz-collection-counter-total" data-total-slides>{{ products_limit }}</span>
            </div>
            <button class="tz-collection-slider-btn tz-collection-slider-next" data-slider-next aria-label="Next products">
              <span class="material-icons-outlined">chevron_left</span>
            </button>
          </nav>
        </div>
      {%- else -%}
        <div class="tz-collection-product-grid">
          {%- for product in section.settings.collection.products limit: products_limit -%}
            {% assign lazy_load = false %}
            {%- if forloop.index > 2 -%}
              {%- assign lazy_load = true -%}
            {%- endif -%}
            {% render 'tz-collection-product-card',
              product: product,
              lazy_load: lazy_load
            %}
          {%- endfor -%}
        </div>
      {%- endif -%}

      {%- comment -%} View All Button {%- endcomment -%}
      {%- if section.settings.show_view_all -%}
        <div class="tz-collection-view-all">
          <a href="{{ section.settings.collection.url }}" class="tz-collection-view-all-btn">
            {{ section.settings.view_all_text | default: 'View All' }}
          </a>
        </div>
      {%- endif -%}
    {%- else -%}
      {%- comment -%} No Products Placeholder {%- endcomment -%}
      <div class="tz-collection-empty">
        <p>{{ 'collections.general.no_matches' | t }}</p>
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "TZ Featured Collection",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Collection"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Select Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 8,
      "label": "Products to Display"
    },
    {
      "type": "checkbox",
      "id": "enable_slider",
      "label": "Enable Slider",
      "default": false
    },
    {
      "type": "header",
      "content": "Header"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "מוצרים מומלצים"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        { "value": "tz-heading-sm", "label": "Small" },
        { "value": "tz-heading-md", "label": "Medium" },
        { "value": "tz-heading-lg", "label": "Large" },
        { "value": "tz-heading-xl", "label": "Extra Large" }
      ],
      "default": "tz-heading-lg",
      "label": "Title Size"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "header",
      "content": "Product Display"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show Vendor/Brand",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_sale_badge",
      "label": "Show Sale Badge",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_wishlist",
      "label": "Show Wishlist Button",
      "default": true
    },
    {
      "type": "select",
      "id": "quick_add",
      "label": "Quick Add Button",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "standard", "label": "Standard" },
        { "value": "bulk", "label": "Bulk" }
      ],
      "default": "standard"
    },
    {
      "type": "header",
      "content": "Actions"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show View All Button",
      "default": true
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "View All Button Text",
      "default": "צפה בכל המוצרים"
    }
  ],
  "presets": [
    {
      "name": "TZ Featured Collection"
    }
  ]
}
{% endschema %}
